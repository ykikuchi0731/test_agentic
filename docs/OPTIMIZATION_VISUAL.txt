================================================================================
API CALL OPTIMIZATION - VISUAL COMPARISON
================================================================================

QUESTION: You get category data recursively - can we reduce API calls?

ANSWER: YES! Here are 3 approaches:

================================================================================
APPROACH 1: NO OPTIMIZATION (Original)
================================================================================

For each article:
  Article → Category API call → Parent API call → Grandparent API call
  
Example with 3 articles:

  Article 1: KB0013936
    ↓ API Call 1
  Category: "規定（ルール、ガイドライン）"
    ↓ API Call 2
  Parent: "IT"
    ↓ API Call 3
  Root: Knowledge Base (404)
  
  Article 2: KB0011677
    ↓ API Call 4
  Category: "申請窓口一覧"
    ↓ API Call 5
  Parent: "IT" (already fetched, but fetching again!)
    ↓ API Call 6
  Root: Knowledge Base (404)
  
  Article 3: KB0011256
    ↓ API Call 7
  Category: "イベント"
    ↓ API Call 8
  Parent: "東京オフィス"
    ↓ API Call 9
  Grandparent: "オフィス"
    ↓ API Call 10
  Root: Knowledge Base (404)

Total: ~10 API calls for 3 articles

================================================================================
APPROACH 2: AUTOMATIC CACHING (Enabled by Default)
================================================================================

First article builds cache, subsequent articles reuse it:

  Article 1: KB0013936
    ↓ API Call 1
  Category: "規定（ルール、ガイドライン）" [CACHE IT]
    ↓ API Call 2
  Parent: "IT" [CACHE IT]
    ↓ API Call 3
  Root: Knowledge Base (404)
  
  Article 2: KB0011677
    ↓ API Call 4
  Category: "申請窓口一覧" [CACHE IT]
    ↓ ✓ CACHE HIT!
  Parent: "IT" [from cache - no API call!]
    ↓ ✓ CACHE HIT!
  Root: Knowledge Base (404)
  
  Article 3: KB0011256
    ↓ API Call 5
  Category: "イベント" [CACHE IT]
    ↓ API Call 6
  Parent: "東京オフィス" [CACHE IT]
    ↓ API Call 7
  Grandparent: "オフィス" [CACHE IT]
    ↓ API Call 8
  Root: Knowledge Base (404)

Total: ~8 API calls for 3 articles (20% reduction)

As you process more articles, cache efficiency increases:
  - 10 articles: ~50% reduction
  - 100 articles: ~60% reduction

================================================================================
APPROACH 3: PRE-FETCHING (BEST!)
================================================================================

ONE-TIME SETUP:
  ↓ API Call 1: GET ALL categories
  Load 593 categories into memory [DONE!]

PROCESSING ARTICLES (zero additional API calls):

  Article 1: KB0013936
    ↓ ✓ CACHE HIT
  Category: "規定（ルール、ガイドライン）" [from memory]
    ↓ ✓ CACHE HIT
  Parent: "IT" [from memory]
    ↓
  Root: Knowledge Base (stop)
  
  Article 2: KB0011677
    ↓ ✓ CACHE HIT
  Category: "申請窓口一覧" [from memory]
    ↓ ✓ CACHE HIT
  Parent: "IT" [from memory]
    ↓
  Root: Knowledge Base (stop)
  
  Article 3: KB0011256
    ↓ ✓ CACHE HIT
  Category: "イベント" [from memory]
    ↓ ✓ CACHE HIT
  Parent: "東京オフィス" [from memory]
    ↓ ✓ CACHE HIT
  Grandparent: "オフィス" [from memory]
    ↓
  Root: Knowledge Base (stop)

Total: 1 API call for ANY NUMBER of articles! (99%+ reduction)

================================================================================
COMPARISON TABLE
================================================================================

                    │ No Cache │ Auto Cache │ Pre-fetch
────────────────────┼──────────┼────────────┼───────────
3 articles          │    10    │      8     │     1
10 articles         │    35    │     18     │     1
100 articles        │   350    │    150     │     1
1000 articles       │  3500    │   1200     │     1
────────────────────┼──────────┼────────────┼───────────
Implementation      │   None   │  Default   │  1 line
Complexity          │          │  (auto)    │ of code

================================================================================
REAL DATA FROM YOUR SERVICENOW INSTANCE
================================================================================

Pre-fetch results:
  • Total categories in system: 593
  • Time to load all: 2.34 seconds (ONE TIME)
  • Memory used: ~0.6 MB
  • API calls during migration: 0

Processing with pre-fetch:
  • 5 articles processed in 0.80 seconds
  • 0 category API calls
  • All data from memory cache

================================================================================
CODE EXAMPLE
================================================================================

# BEFORE (recursive, many API calls)
kb = KnowledgeBase(client)
for article in articles:
    hierarchy = kb.get_category_hierarchy(cat_id)  # 3-4 API calls each

# AFTER (pre-fetch, ONE API call total)
kb = KnowledgeBase(client)
kb.prefetch_all_categories()  # <-- Add this ONE line
for article in articles:
    hierarchy = kb.get_category_hierarchy(cat_id)  # 0 API calls!

================================================================================
RECOMMENDATION
================================================================================

For ServiceNow → Notion migration:

  ✅ Use pre-fetching (prefetch_all_categories())
  ✅ One-time cost: 2.34 seconds
  ✅ Benefit: 99% reduction in API calls
  ✅ Perfect for bulk migrations
  
Code:
  kb = KnowledgeBase(client)
  kb.prefetch_all_categories()  # Load once
  # Process thousands of articles with zero category API calls!

================================================================================
